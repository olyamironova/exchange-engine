# exchange-engine

Exchange Engine — сервис для обмена валютами на бирже. Проект реализует полный цикл обработки ордеров: приём, сопоставление, исполнение, модификацию, отмену и сохранение состояния.  

## Немного терминов предметной области для большей ясности  
* *Ордер (Order)* — заявка на покупку или продажу актива, может быть рыночной или лимитной.
* *Торговая пара / символ (Symbol)* — уникальный идентификатор актива, например BTC/USD.
* *Ордербук (Orderbook)* — структура, где хранятся все открытые ордера по символу.
* *Сделка (Trade)* — результат сопоставления двух ордеров, фиксируется цена и количество.
* *Снимок (Snapshot)* — сохранённое состояние ордербука в момент времени, используется для отката или анализа.

Matching engine работает по принципу FIFO + Price Priority:
* Ордер с лучшей ценой исполняется первым.
* При равной цене ордера исполняются в порядке поступления (FIFO).


## Matching algorithm
1. При поступлении нового ордера система ищет встречные ордера противоположной стороны (покупка <-> продажа) по цене и времени создания.
2. Выбираются подходящие кандидаты из базы (или из кеша).
3. Определяется объем исполнения (минимум между доступными объемами двух ордеров).
4. Создается новая запись `Trade` с деталями сделки.
5. Оба ордера обновляются:
   - если ордер исполнен полностью — статус `FILLED`;
   - если частично — статус `PARTIALLY_FILLED`.
6. Все изменения фиксируются в транзакции PostgreSQL.
7. События отправляются в Kafka для дальнейшей обработки.


## Стек технологий
* Язык программирования: Go 1.21
* База данных: PostgreSQL + pgx
* Транспортный слой для API: gRPC
* Кэширование: Redis
* Мониторинг: Prometheus + Grafana
* Миграции: flyway
* Асинхронная обработка событий: Kafka
* Локальное развертывание сервисов: docker-compose
* Сборка, запуск: Dockerfile


## API Endpoints
|`POST` | `/orders`| Создает новый ордер и возвращает массив выполненных сделок |
--------|----------|------------------------------------------------------------
|`PUT` | `/orders/{orderID}` | Модифицирует открытый ордер |
|`DELETE` | `/orders/{orderID}` | Отменяет открытый ордер |
|`GET`| `/orders/{orderID}`|Возвращает информацию по заявке (ордеру) по id ордера |
|`GET`|`/orders/{orderID}/trades`| Возвращает список сделок для конкретного ордера |
|`GET`|`/orderbook/{symbol}`| Возвращает текущее состояние биржевого стакана для торгового символа |
|`POST`|`/orderbook/{symbol}/snapshot`| Сохраняет снимок текущего биржевого стакана|
|`PUT`|`/orderbook/snapshot/{snapshotID}/restore`|Восстанавливает биржевой стакан из ранее сохраненного снимка |