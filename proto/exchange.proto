syntax = "proto3";

package proto;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/olyamironova/exchange-engine/proto;exchange";

service Exchange {
  rpc SubmitOrder(SubmitOrderRequest) returns (SubmitOrderResponse);
  rpc ModifyOrder(ModifyOrderRequest) returns (ModifyOrderResponse);
  rpc CancelOrder(CancelOrderRequest) returns (CancelOrderResponse);

  rpc GetOrder(GetOrderRequest) returns (GetOrderResponse);
  rpc GetTradesForOrder(GetTradesRequest) returns (GetTradesResponse);
  rpc GetOrderbook(GetOrderbookRequest) returns (GetOrderbookResponse);

  rpc SnapshotOrderbook(SnapshotRequest) returns (SnapshotResponse);
  rpc RestoreOrderbook(RestoreRequest) returns (RestoreResponse);
}

message SubmitOrderRequest {
  string client_id = 1;
  string symbol = 2;
  string side = 3;   // BUY/SELL
  string type = 4;   // LIMIT/MARKET
  double price = 5;
  double quantity = 6;
}

message SubmitOrderResponse {
  string order_id = 1;
  repeated Trade trades = 2;
  double remaining = 3;
}

message ModifyOrderRequest {
  string order_id = 1;
  string client_id = 2;
  double new_price = 3;
  double new_quantity = 4;
}

message ModifyOrderResponse {
  string order_id = 1;
  bool modified = 2;
  string message = 3;
}

message CancelOrderRequest {
  string order_id = 1;
  string client_id = 2;
}

message CancelOrderResponse {
  string order_id = 1;
  bool cancelled = 2;
  string message = 3;
}

message GetOrderRequest {
  string order_id = 1;
}

message GetOrderResponse {
  Order order = 1;
}

message GetTradesRequest {
  string order_id = 1;
}

message GetTradesResponse {
  repeated Trade trades = 1;
}

message GetOrderbookRequest {
  string symbol = 1;
}

message GetOrderbookResponse {
  repeated Order bids = 1;
  repeated Order asks = 2;
  int64 timestamp = 3;
}

message SnapshotRequest {
  string symbol = 1;
}

message SnapshotResponse {
  string snapshot_id = 1;
  string message = 2;
}

message RestoreRequest {
  string snapshot_id = 1;
}

message RestoreResponse {
  bool ok = 1;
  string message = 2;
}

message Order {
  string id = 1;
  string client_id = 2;
  string symbol = 3;
  string side = 4;
  string type = 5;
  double price = 6;
  double quantity = 7;
  double remaining = 8;
  google.protobuf.Timestamp created_at = 9;
}

message Trade {
  string id = 1;
  string buy_order = 2;
  string sell_order = 3;
  double price = 4;
  double quantity = 5;
  google.protobuf.Timestamp timestamp = 6;
}